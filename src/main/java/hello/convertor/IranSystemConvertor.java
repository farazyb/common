package hello.convertor;

/**
 *
 */
public class IranSystemConvertor {

    private int[][] m_CodePage;

    public IranSystemConvertor() {
        int[][] arrarrn = new int[50][];
        int[] arrn = new int[7];
        arrn[0] = 32;
        arrn[1] = 32;
        arrn[2] = 32;
        arrn[3] = 32;
        arrn[4] = 32;
        arrn[5] = 32;
        arrarrn[0] = arrn;
        int[] arrn2 = new int[7];
        arrn2[0] = 128;
        arrn2[1] = 128;
        arrn2[2] = 128;
        arrn2[3] = 128;
        arrn2[4] = 48;
        arrn2[5] = 48;
        arrarrn[1] = arrn2;
        int[] arrn3 = new int[7];
        arrn3[0] = 129;
        arrn3[1] = 129;
        arrn3[2] = 129;
        arrn3[3] = 129;
        arrn3[4] = 49;
        arrn3[5] = 49;
        arrarrn[2] = arrn3;
        int[] arrn4 = new int[7];
        arrn4[0] = 130;
        arrn4[1] = 130;
        arrn4[2] = 130;
        arrn4[3] = 130;
        arrn4[4] = 50;
        arrn4[5] = 50;
        arrarrn[3] = arrn4;
        int[] arrn5 = new int[7];
        arrn5[0] = 131;
        arrn5[1] = 131;
        arrn5[2] = 131;
        arrn5[3] = 131;
        arrn5[4] = 51;
        arrn5[5] = 51;
        arrarrn[4] = arrn5;
        int[] arrn6 = new int[7];
        arrn6[0] = 132;
        arrn6[1] = 132;
        arrn6[2] = 132;
        arrn6[3] = 132;
        arrn6[4] = 52;
        arrn6[5] = 52;
        arrarrn[5] = arrn6;
        int[] arrn7 = new int[7];
        arrn7[0] = 133;
        arrn7[1] = 133;
        arrn7[2] = 133;
        arrn7[3] = 133;
        arrn7[4] = 53;
        arrn7[5] = 53;
        arrarrn[6] = arrn7;
        int[] arrn8 = new int[7];
        arrn8[0] = 134;
        arrn8[1] = 134;
        arrn8[2] = 134;
        arrn8[3] = 134;
        arrn8[4] = 54;
        arrn8[5] = 54;
        arrarrn[7] = arrn8;
        int[] arrn9 = new int[7];
        arrn9[0] = 135;
        arrn9[1] = 135;
        arrn9[2] = 135;
        arrn9[3] = 135;
        arrn9[4] = 55;
        arrn9[5] = 55;
        arrarrn[8] = arrn9;
        int[] arrn10 = new int[7];
        arrn10[0] = 136;
        arrn10[1] = 136;
        arrn10[2] = 136;
        arrn10[3] = 136;
        arrn10[4] = 56;
        arrn10[5] = 56;
        arrarrn[9] = arrn10;
        int[] arrn11 = new int[7];
        arrn11[0] = 137;
        arrn11[1] = 137;
        arrn11[2] = 137;
        arrn11[3] = 137;
        arrn11[4] = 57;
        arrn11[5] = 57;
        arrarrn[10] = arrn11;
        int[] arrn12 = new int[7];
        arrn12[0] = 137;
        arrn12[1] = 137;
        arrn12[2] = 137;
        arrn12[3] = 137;
        arrn12[4] = 57;
        arrn12[5] = 57;
        arrarrn[11] = arrn12;
        int[] arrn13 = new int[7];
        arrn13[0] = 138;
        arrn13[1] = 138;
        arrn13[2] = 138;
        arrn13[3] = 138;
        arrn13[4] = 161;
        arrn13[5] = 1548;
        arrarrn[12] = arrn13;
        arrarrn[13] = new int[]{139, 139, 139, 139, 220, 1600, 2};
        int[] arrn14 = new int[7];
        arrn14[0] = 140;
        arrn14[1] = 140;
        arrn14[2] = 140;
        arrn14[3] = 140;
        arrn14[4] = 63;
        arrn14[5] = 1567;
        arrarrn[14] = arrn14;
        arrarrn[15] = new int[]{141, 141, 141, 141, 194, 1570, 1};
        arrarrn[16] = new int[]{142, 142, 142, 142, 198, 1574, 2};
        int[] arrn15 = new int[7];
        arrn15[0] = 143;
        arrn15[1] = 143;
        arrn15[2] = 143;
        arrn15[3] = 143;
        arrn15[4] = 193;
        arrn15[5] = 1569;
        arrarrn[17] = arrn15;
        arrarrn[18] = new int[]{144, 144, 145, 145, 199, 1575, 1};
        arrarrn[19] = new int[]{146, 147, 146, 147, 200, 1576, 2};
        arrarrn[20] = new int[]{148, 149, 148, 149, 129, 1662, 2};
        arrarrn[21] = new int[]{150, 151, 150, 151, 202, 1578, 2};
        arrarrn[22] = new int[]{152, 153, 152, 153, 203, 1579, 2};
        arrarrn[23] = new int[]{154, 155, 154, 155, 204, 1580, 2};
        arrarrn[24] = new int[]{156, 157, 156, 157, 141, 1670, 2};
        arrarrn[25] = new int[]{158, 159, 158, 159, 205, 1581, 2};
        arrarrn[26] = new int[]{160, 161, 160, 161, 206, 1582, 2};
        arrarrn[27] = new int[]{162, 162, 162, 162, 207, 1583, 1};
        arrarrn[28] = new int[]{163, 163, 163, 163, 208, 1584, 1};
        arrarrn[29] = new int[]{164, 164, 164, 164, 209, 1585, 1};
        arrarrn[30] = new int[]{165, 165, 165, 165, 210, 1586, 1};
        arrarrn[31] = new int[]{166, 166, 166, 166, 142, 1688, 1};
        arrarrn[32] = new int[]{167, 168, 167, 168, 211, 1587, 2};
        arrarrn[33] = new int[]{169, 170, 169, 170, 212, 1588, 2};
        arrarrn[34] = new int[]{171, 172, 171, 172, 213, 1589, 2};
        arrarrn[35] = new int[]{173, 174, 173, 174, 214, 1590, 2};
        arrarrn[36] = new int[]{175, 175, 175, 175, 216, 1591, 3};
        arrarrn[37] = new int[]{224, 224, 224, 224, 217, 1592, 3};
        arrarrn[38] = new int[]{225, 228, 226, 227, 218, 1593, 3};
        arrarrn[39] = new int[]{229, 232, 230, 231, 219, 1594, 3};
        arrarrn[40] = new int[]{233, 234, 233, 234, 221, 1601, 2};
        arrarrn[41] = new int[]{235, 236, 235, 236, 222, 1602, 2};
        arrarrn[42] = new int[]{237, 238, 237, 238, 152, 1705, 2};
        arrarrn[43] = new int[]{239, 240, 239, 240, 144, 1711, 2};
        arrarrn[44] = new int[]{241, 243, 241, 243, 225, 1604, 2};
        arrarrn[45] = new int[]{244, 245, 244, 245, 227, 1605, 2};
        arrarrn[46] = new int[]{246, 247, 246, 247, 228, 1606, 2};
        arrarrn[47] = new int[]{248, 248, 248, 248, 230, 1608, 1};
        arrarrn[48] = new int[]{249, 251, 249, 250, 229, 1607, 3};
        arrarrn[49] = new int[]{253, 254, 252, 254, 237, 1740, 3};
        this.m_CodePage = arrarrn;
    }

    private String BeforeConvertingToIranSystem(String szText) {
        szText = szText.replace('\u0623', '\u0627');
        szText = szText.replace('\u00c3', '\u00c7');
        szText = szText.replace('\u0643', '\u06a9');
        szText = szText.replace('\u00df', '\u0098');
        szText = szText.replace('\u064a', '\u06cc');
        szText = szText.replace('\u0649', '\u06cc');
        szText = szText.replace('\u00ec', '\u00ed');
        return szText;
    }

    private int GetCodePageIndex(int c) {
        int iMax = 49;
        for (int i = 0; i < iMax; ++i) {
            if (c != this.m_CodePage[i][4] && c != this.m_CodePage[i][5]) {
                continue;
            }
            return i;
        }
        return -1;
    }

    private int GetCoherency(int codepageindex) {
        if (codepageindex == -1) {
            return 0;
        }
        return this.m_CodePage[codepageindex][6];
    }

    private char GetCharachter(int nCodePageIndex, int nPrevCoherency, int nNextCoherency) {
        return (char) this.m_CodePage[nCodePageIndex][(nPrevCoherency == 2 || nPrevCoherency == 3 ? 1 : 0) << 1 | (nNextCoherency != 0 ? 1 : 0)];
    }

    private String AfterConvertingToIranSystem(String szText) {
        String szFrom = "\u0000x91\u0000xF3\u0000x00";
        String szTo = "\u0000xF2\u0000x00";
        szText = szText.replace(szFrom, szTo);
        return szText;
    }

    public String ConvertFromUnicodeToIranSystem(String input) {
        input = this.BeforeConvertingToIranSystem(input);
        int nPrevCoherency = 0;
        int nNextCoherency = 0;
        String szRet = "";
        int iMax = input.length();
        for (int i = 0; i < iMax; ++i) {
            char cPrevChar = i > 0 ? input.charAt(i - 1) : (char) '\u0000';
            char cCurrentChar = input.charAt(i);
            char cNextChar = i < iMax - 1 ? input.charAt(i + 1) : (char) '\u0000';
            int nCodePageIndex = this.GetCodePageIndex(cCurrentChar);
            if (nCodePageIndex == -1) {
                szRet = String.valueOf(szRet) + (char) cCurrentChar;
                continue;
            }
            nPrevCoherency = this.GetCoherency(this.GetCodePageIndex(cPrevChar));
            nNextCoherency = this.GetCoherency(this.GetCodePageIndex(cNextChar));
            szRet = String.valueOf(this.GetCharachter(nCodePageIndex, nPrevCoherency, nNextCoherency)) + szRet;
        }
        szRet = this.AfterConvertingToIranSystem(szRet);
        String Res = "";
        for (int i = 0; i < szRet.length(); ++i) {
            Res = String.valueOf(szRet.substring(i, i + 1)) + Res;
        }
        return Res;
    }

    public String Unicode2Utf8(String unicode) {
        String output = "";
        unicode = this.BeforeConvertingToIranSystem(unicode);
        char[] charArray = unicode.toCharArray();
        for (int i = 0; i < charArray.length; ++i) {
            char a = charArray[i];
            if (a > '\u00ff') {
                for (int j = 0; j < 50; ++j) {
                    if (this.m_CodePage[j][5] != a) {
                        continue;
                    }
                    output = String.valueOf(output) + String.valueOf((char) this.m_CodePage[j][4]);
                }
                continue;
            }
            output = String.valueOf(output) + a;
        }
        return output;
    }

    public String UTF82Unicode(String unicode) {
        int i;
        String output = "";
        char[] charArray = new char[unicode.length() / 2];
        int k = 0;
        for (i = 0; i < unicode.length(); i += 2) {
            String str = unicode.substring(i, i + 2);
            charArray[k] = (char) Integer.parseInt(str, 16);
            ++k;
        }
        for (i = 0; i < charArray.length; ++i) {
            char a = charArray[i];
            boolean found = false;
            for (int j = 0; j < 50; ++j) {
                if ((char) this.m_CodePage[j][4] != a) {
                    continue;
                }
                output = String.valueOf(output) + String.valueOf((char) this.m_CodePage[j][5]);
                found = true;
                break;
            }
            if (found) {
                continue;
            }
            output = String.valueOf(output) + a;
        }
        return output;
    }
}
